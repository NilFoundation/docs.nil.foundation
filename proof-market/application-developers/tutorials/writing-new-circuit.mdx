import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

# Writing a new circuit

This tutorial covers developing a simple circuit and compiling it.

## Meeting the prerequisites

First, install the zkLLVM compiler from a pre-built binary distributed as a Debian package.

```bash
echo 'deb [trusted=yes]  http://deb.nil.foundation/ubuntu/ all main' >>/etc/apt/sources.list
apt update
apt install -y zkllvm
```

To install the Rust compiler from a pre-built binary, run the following commands.

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
curl --proto '=https' --tlsv1.2 -sSf https://cdn.jsdelivr.net/gh/NilFoundation/zkllvm@master/rslang-installer.py | python - --channel nightly
```

Verify the installation.

```bash
clang-zkllvm --version
rustc +zkllvm -V
```

To learn about other means of installing zkLLVM, [**click here**](../../../zkllvm/getting-started/installation#building-from-sources).

## Writing the circuit code

First, create a new `.cpp` (C++) or a new `.rs` (Rust) file. 

:::tip

When using Rust, we recommend initializing a new Cargo crate and writing the circuit code in `./src/main.rs`. This will allow for using `cargo` as a compiler rather than `rustc`.

:::

Copy and paste the following code inside the file.

<Tabs groupId='language'>
  <TabItem value='cpp' label='C++'>

    ```cpp
    int pow_2(int a) {
        int res = 1;
        for (int i = 0; i < 2; ++i) {
            res *= a;
        }
        return res;
    }

    [[circuit]] int int_arithmetic_example(int a, int b) {
        int c = (a + b) * a + b * (a + b) * (a + b);
        const int constant = 77;
        return c * c * c * (b - a) + pow_2(a) + constant;
    }
    ```

  </TabItem>
  <TabItem value='rust' label='Rust'>

    ```rust
    #![no_main]

    use ark_ff::{Field, MontFp};
    use ark_pallas::Fq;
    use unroll::unroll_for_loops;

    #[unroll_for_loops]
    fn pow_2(a: i32) -> i32 {
        let mut : i32 = 1;
        for i in 0..2 {
            acc = acc * a;
        }

        acc
    }

    #[circuit]
    pub fn field_arithmetic_example(a: Fq, b: Fq) -> Fq {
        let c = (a + b) * a + b * (a + b) * (a + b);
        const CONSTANT: i32 = 77;
        c * c * c / (b - a) + pow_2(a) + CONSTANT
    }
    ```

  </TabItem>
</Tabs>

## Compiling the circuit

Run the following command to produce circuit IR.

<Tabs groupId='language'>
  <TabItem value='cpp' label='C++'>

    ```bash
    clang-zkllvm -S -emit-llvm -target assigner -O1 -o circuit.ll path/to/circuit.cpp
    ```

  </TabItem>
  <TabItem value='rust' label='Rust'>

    Using `cargo`:

    ```bash
    cargo +zkllvm build --target assigner-unknown-unknown
    ```

    Using `rustc`:

    ```bash
    rustc +zkllvm --target assigner-unknown-unknown --emit=llvm-ir -C opt-level=3 circuit.rs 
    ```

  </TabItem>
</Tabs>

This should produce an `.ll` file with the circuit IR, which can then be transformed into a statement.