import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

# Installation and configuration

## Installing dependencies

Before installing zkLLVM, install the following dependencies.

- [**Boost**](https://www.boost.org/) >= 1.76.0
- [**CMake**](https://cmake.org/) >= 3.5
- [**Clang**](https://clang.llvm.org/) >= 12.0
- [**Python**](https://www.python.org/) >= 3.7
- [**Rust**](https://www.rust-lang.org/) >= 1.68 (only if there is a need to use the Rust frontend)

Every dependency apart from Rust can be installed by executing the following command.

```bash
sudo apt install build-essential libssl-dev cmake clang-12 git curl pkg-config zlib
```

:::info

Note that the command installs not only the required dependencies but several other essential packages such as `build-essential`, `zlib`, `git`, and `curl`.

:::

To install Rust, execute the following command.

```bash
curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh
```

:::tip[Ninja]

The [**Ninja build system**](https://ninja-build.org/) can make building zkLLVM from sources faster and more convenient. While it is not a direct dependency, using Ninja is preferable to simply using Unix makefiles. Install Ninja by running the below command.

```bash
sudo apt-get install ninja-build
```

:::

:::tip[Installing Boost]

Installing Boost from source is the most consistent way to ensure that the latest version of Boost is installed that matches the above version constraint.

To install Boost from source, do the following.

1. Navigate to the folder where you want to install Boost and download Boost.

```bash
wget https://boostorg.jfrog.io/artifactory/main/release/1.84.0/source/boost_1_84_0_rc1.tar.gz
```

2. Extract the archive with Boost.

```bash
cd boost_1_84_0
```

3. Prepare the build system for Boost by running `bootstrap.sh`.

```bash
./bootstrap.sh
```

4. Install Boost system-wide.

```bash
sudo ./b2 install
```

:::

## Installing zkLLVM as a packagage

zkLLVM is distributed as a Deb package which can be installed using the following commands.

```bash
echo 'deb [trusted=yes]  http://deb.nil.foundation/ubuntu/ all main' >>/etc/apt/sources.list
apt update
apt install -y zkllvm
```

## Installing zkLLVM from sources

zkLLVm can also be built directly from its source repository by following the below steps.

### Clone the repository

Clone the repository and all of its sub-modules.

```bash
git clone --recurse-submodules git@github.com:NilFoundation/zkllvm.git
cd zkllvm
```

### Configure `cmake`

This step is needed to define the format in which zkLLVM will provide IR representations of circuits among these options:

- Binary format (`.bc`)
- Text format (`.ll`)

:::info

Presently, only the `.ll` format is compatible with [**Proof Market**](../../proof-market/intro).

:::

Run the following command to configure `cmake`.

<Tabs>
  <TabItem value='bcUnix' label='.bc (Unix)'>
    ```bash
    cmake -G "Unix Makefiles" -B ${ZKLLVM_BUILD:-build} -DCMAKE_BUILD_TYPE=Release .
    ```
  </TabItem>
  <TabItem value='llUnix' label='.ll (Unix)'>
    ```bash
    cmake -G "Unix Makefiles" -B ${ZKLLVM_BUILD:-build} -DCMAKE_BUILD_TYPE=Release -DCIRCUIT_ASSEMBLY_OUTPUT=TRUE .
    ```
  </TabItem>
  <TabItem value='bcNinja' label='.bc (Ninja)'>
    ```bash
    cmake -G "Ninja" -B ${ZKLLVM_BUILD:-build} -DCMAKE_BUILD_TYPE=Release .
    ```
  </TabItem>
  <TabItem value='llNinja' label='.ll (Ninja)'>
    ```bash
    cmake -G "Ninja" -B ${ZKLLVM_BUILD:-build} -DCMAKE_BUILD_TYPE=Release -DCIRCUIT_ASSEMBLY_OUTPUT=TRUE .
    ```
  </TabItem>
</Tabs>

### Build `clang` and `assigner`

The next step is to build the C++ compiler and the `assigner` tool.

<Tabs groupId='buildSystem'>
  <TabItem value='unix' label='Unix'>
    ```bash
    make -C ${ZKLLVM_BUILD:-build} assigner clang -j$(nproc)
    ```
  </TabItem>
  <TabItem value='ninja' label='Ninja'>
    ```bash
    ninja -C ${ZKLLVM_BUILD:-build} assigner clang -j$(nproc)
    ```
  </TabItem>
</Tabs>

### Build the Rust compiler

To work with the Rust frontend, perform the following actions.

#### Reconfigure `cmake`

This step is needed to add Rust tools to `cmake`.
