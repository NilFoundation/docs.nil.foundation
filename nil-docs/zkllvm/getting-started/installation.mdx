import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

# Installation and configuration

## Installing dependencies

Before installing zkLLVM, install the following dependencies.

- [**Boost**](https://www.boost.org/) >= 1.76.0
- [**CMake**](https://cmake.org/) >= 3.5
- [**Clang**](https://clang.llvm.org/) >= 12.0
- [**Python**](https://www.python.org/) >= 3.7
- [**Rust**](https://www.rust-lang.org/) >= 1.68 (only if there is a need to use the Rust frontend)

Every dependency apart from Rust can be installed by executing the following command.

```bash
sudo apt install build-essential libssl-dev cmake clang-12 git curl pkg-config libboost-all-dev
```

:::info

Note that the command installs not only the required dependencies but several other essential packages such as `build-essential`, `git`, and `curl`.

:::

To install Rust, execute the following command.

```bash
curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh
```

## Installing zkLLVM as a packagage

zkLLVM is distributed as a Deb package which can be installed using the following commands.

```bash
echo 'deb [trusted=yes]  http://deb.nil.foundation/ubuntu/ all main' >>/etc/apt/sources.list
apt update
apt install -y zkllvm
```

## Installing zkLLVM from sources

zkLLVm can also be built directly from its source repository.

### Clone the repository

Clone the repository and all of its sub-modules.

```bash
git clone --recurse-submodules git@github.com:NilFoundation/zkllvm.git
cd zkllvm
```

### Configure `cmake`

This step is needed to define the format in which zkLLVM will provide IR representations of circuits:

- A binary format (`.bc`)
- A text format (`.ll`)

:::info

Presently, only the `.ll` format is compatible with [**Proof Market**](../../proof-market/intro).

:::

Run the following command to configure `cmake`.

<Tabs>
  <TabItem value='.bc' label='.bc'>
    ```bash
    cmake -G "Unix Makefiles" -B ${ZKLLVM_BUILD:-build} -DCMAKE_BUILD_TYPE=Release .
    ```
  </TabItem>
  <TabItem value='.ll' label='.ll'>
    ```bash
    cmake -G "Unix Makefiles" -B ${ZKLLVM_BUILD:-build} -DCMAKE_BUILD_TYPE=Release -DCIRCUIT_ASSEMBLY_OUTPUT=TRUE .
    ```
  </TabItem>
</Tabs>

:::tip[`config.guess` syntax error]

If the config process encounters a syntax error in a `config.guess` file, execute the following commands.

```bash
sudo apt install dos2unix
dos2unix {./pathToConfigFile/config.guess}
```

This will replace all DOS line endings in the file with UNIX line endings.

:::

## Build `clang` and `assigner`

<Tabs groupId='operating-systems'>
  <TabItem value='win' label='Windows'>
    Use Ctrl + C to copy.
  </TabItem>
  <TabItem value='mac' label='macOS'>
    Use Command + C to copy.
  </TabItem>
</Tabs>

<Tabs groupId='operating-systems'>
  <TabItem value='win' label='Windows'>
    Use Ctrl + V to paste.
  </TabItem>
  <TabItem value='mac' label='macOS'>
    Use Command + V to paste.
  </TabItem>
</Tabs>

If you are using Unix makefiles:

```bash
make -C ${ZKLLVM_BUILD:-build} assigner clang -j$(nproc)
```

If you are using Ninja:

```bash
ninja -C ${ZKLLVM_BUILD:-build} assigner clang -j$(nproc)
```

## Examples

### Build Circuit IR

This builds some samples we have in the `examples` directory

```bash
make -C ${ZKLLVM_BUILD:-build} circuit_examples -j$(nproc)
```

### Generate Execution trace

This generates an execution trace for the arithmetic example built.

```
${ZKLLVM_BUILD:-build}/bin/assigner/assigner -b ${ZKLLVM_BUILD:-build}/examples/arithmetics_example.bc -i examples/arithmetics.inp -t assignment.tbl -c circuit.crct
```

Where

Inputs:

- _**b**_: Binary representation of the circuit
- _**i**_: Public inputs for the circuit

Output:

- _**t**_: Execution trace
- _**c**_: Pre-processed constraints
